/*! BuildToolsCookbook v2.0.0 | (c) 2022 iconix | MIT License | http://github.com/cferdinandi/build-tools-boilerplate */
function t(t,e){const i=.5;try{t.translate(i,i),e()}finally{t.translate(-.5,-.5)}}function e(e){let i=e.board,s=i.ctx;t(s,(()=>{if(s.filter=i.activeFilter,s.fillStyle="white",s.strokeStyle="darkgreen",s.fillRect(0,0,i.canvas.width,i.canvas.height),e.paused){let t=i.needsPermission();s.font=50*i.ratio+'px "bootstrap-icons"',s.fillStyle=t?"darkkhaki":"darkgreen",s.fillText(String.fromCharCode(t?62266:62655),30*i.ratio,50*i.ratio)}}))}function i(e,i){e._body.forEach((e=>function(e,i){let s=i.ctx;t(s,(()=>{s.fillStyle="lightgreen",s.strokeStyle="darkgreen",s.fillRect(e.x,e.y,i.blockSize,i.blockSize),s.strokeRect(e.x,e.y,i.blockSize,i.blockSize)}))}(e,i)))}function s(e,i){let s=i.ctx;t(s,(()=>{s.fillStyle=e.fill_color,s.strokeStyle=e.border_color,s.fillRect(e.x,e.y,i.blockSize,i.blockSize),s.strokeRect(e.x,e.y,i.blockSize,i.blockSize)}))}class n{constructor(t,e){this._canvas=t,this._ctrlPanel=e,this.ctx=this._canvas.getContext("2d"),this._boardSize=this._calculateBoardSize(),this._ratio=window.devicePixelRatio||1,this._sizeCanvas(),this._sizeControlPanel(),this._width=t.width,this._height=t.height,this._blockSize=t.width/30,this.resetFilter()}get canvas(){return this._canvas}get activeFilter(){return this._activeFilter}get width(){return this._width}get height(){return this._height}get blockSize(){return this._blockSize}get ratio(){return this._ratio}resetFilter(){this._activeFilter="none"}setEndGameFilter(){this._activeFilter="grayscale(0.8) blur(0.5px)"}setPauseGameFilter(){this._activeFilter="contrast(1.4) sepia(1)"}enterFullScreen(){this._canvas.requestFullscreen().then((function(){try{screen.lockOrientationUniversal=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation,screen.lockOrientationUniversal("portrait-primary")}catch(t){}}))}exitFullScreen(){document.exitFullscreen()}createMotionRequestBtn(){let t=document.createElement("button");return t.innerHTML="Allow Motion Control",t.setAttribute("id","motionRequest"),t.type="button",self._ctrlPanel.appendChild(t),t}removeMotionRequestBtn(){let t=document.getElementById("motionRequest");t&&t.parentNode.removeChild(t)}needsPermission(){return null!==document.getElementById("motionRequest")}addTouchHandlers(t,e){this._canvas.addEventListener("touchstart",t),this._canvas.addEventListener("touchend",e)}_calculateBoardSize(){let t=Math.min(window.innerWidth,window.innerHeight)-50;return 30*parseInt(t/30)-30}_sizeCanvas(){this._canvas.style.width=this._boardSize+"px",this._canvas.style.height=this._boardSize+"px",this._canvas.width=this._boardSize*this._ratio,this._canvas.height=this._canvas.width}_sizeControlPanel(){this._ctrlPanel.style.width=this._boardSize+"px",this._ctrlPanel.style.height="50px",this._ctrlPanel.width=this._boardSize*this._ratio,this._ctrlPanel.height=50*this._ratio}}function o(t,e,i,s){let n={x:h(0,t.width-t.blockSize,t.blockSize),y:h(0,t.height-t.blockSize,t.blockSize),fill_color:i,border_color:s};return e._body.forEach((function(h){h.x==n.x&&h.y==n.y&&(n=o(t,e,i,s))})),n}function h(t,e,i){return Math.round((Math.random()*(e-t)+t)/i)*i}class a{constructor(t,e,i){this._body=[{x:t/2,y:e/2},{x:t/2-i,y:e/2},{x:t/2-2*i,y:e/2},{x:t/2-3*i,y:e/2},{x:t/2-4*i,y:e/2}],this._blockSize=i,this._dx=this._dxAtPause=i,this._dy=this._dyAtPause=0,this.isChangingDirection=!1}advanceHead(){const t={x:this._body[0].x+this._dx,y:this._body[0].y+this._dy};this._body.unshift(t)}advanceTail(){this._body.pop()}pause(){this._dxAtPause=this._dx,this._dyAtPause=this._dy,this._dx=this._dy=0}unpause(){this._dx=this._dxAtPause,this._dy=this._dyAtPause}didEat(t){return this._body[0].x===t.x&&this._body[0].y===t.y}didCollide(t,e,i){for(let t=4;t<this._body.length;t++){if(this._body[t].x===this._body[0].x&&this._body[t].y===this._body[0].y)return!0}const s=this._body[0].x<0,n=this._body[0].x>t-i,o=this._body[0].y<0,h=this._body[0].y>e-i;return s||n||o||h}changeDirectionByKey(t){if(this.isChangingDirection)return;this.isChangingDirection=!0;const e=this._dy===-this._blockSize,i=this._dy===this._blockSize,s=this._dx===this._blockSize,n=this._dx===-this._blockSize;"ArrowLeft"!==t||s||(this._dx=-this._blockSize,this._dy=0),"ArrowUp"!==t||i||(this._dx=0,this._dy=-this._blockSize),"ArrowRight"!==t||n||(this._dx=this._blockSize,this._dy=0),"ArrowDown"!==t||e||(this._dx=0,this._dy=this._blockSize)}changeDirectionByMvmt(t,e,i,s,n){if(this.isChangingDirection)return{newBeta:i,newGamma:s};this.isChangingDirection=!0;const o=i-t,h=s-e,a=this._dy===-this._blockSize,r=this._dy===this._blockSize,d=this._dx===this._blockSize,l=this._dx===-this._blockSize;let c,_;return o<-n?(a||(dir="DOWN",this._dx=0,this._dy=this._blockSize,_=e),c=t):o>n?(r||(dir="UP",this._dx=0,this._dy=-this._blockSize,_=e),c=t):h<-n?(l||(dir="RIGHT",this._dx=this._blockSize,this._dy=0,c=t),_=e):h>n&&(d||(dir="LEFT",this._dx=-this._blockSize,this._dy=0,c=t),_=e),{newBeta:c,newGamma:_}}}const r=new Set(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]);class d{constructor(t,e,i,s){this._board=t,this._snake=e,this._food=i,this._score=0,this._paused=!1,this._ended=!1,this._speed=s,this._lastBeta=0,this._lastGamma=0,this._setupControls()}get board(){return this._board}get snake(){return this._snake}get food(){return this._food}get speed(){return this._speed}get score(){return this._score}get activeFilter(){return this._activeFilter}get paused(){return this._paused}run(){if(this._didEnd())return void this._end();let t=setTimeout((()=>{this._snake.isChangingDirection=!1,e(this),function(t,e){let i=e.ctx;i.font=50*e.ratio+'px "Saira", serif',i.textAlign="center",i.fillStyle="gray",i.fillText(t,e.canvas.width/2,e.canvas.height/2,e.canvas.width)}(this._score,this._board),s(this._food,this._board),this._paused||this._advanceSnake(),i(this._snake,this._board),this.run()}),this._speed);this._timeout||(this._timeout=t)}_advanceSnake(){if(this._snake.advanceHead(),this._snake.didEat(this._food)){this._score+=10;let t=o(this._board,this._snake,"red","darkred");this._food=t}else this._snake.advanceTail()}_didEnd(){return this._snake.didCollide(this._board.width,this._board.height,this._board.blockSize)}_end(){this._ended=!0,this._board.setEndGameFilter(),e(this),s(this._food,this._board),i(this._snake,this._board),function(t){let e=t.ctx;e.font=50*t.ratio+'px "Saira", serif',e.textAlign="center",e.fillStyle="gray",e.fillText("DED",t.canvas.width/2,t.canvas.height/2,t.canvas.width)}(this._board),document.removeEventListener("keydown",this._handleKeyInput),document.addEventListener("keydown",c),document.removeEventListener("click",this._togglePause),document.addEventListener("click",c)}_togglePause(){this._paused=!this._paused,this._paused?(this._snake.pause(),this._board.setPauseGameFilter()):(this._snake.unpause(),this._board.resetFilter())}_setupControls(){this._lastBeta=this._lastGamma=0,this._handleDeviceMvmt=this._handleDeviceMvmt.bind(this),this._handleKeyInput=this._handleKeyInput.bind(this),this._handleVisibilityChange=this._handleVisibilityChange.bind(this),this._requestDeviceOrientation=this._requestDeviceOrientation.bind(this),this._togglePause=this._togglePause.bind(this),this._board.enterFullScreen=this._board.enterFullScreen.bind(this._board),document.addEventListener("keydown",this._handleKeyInput),document.addEventListener("click",this._togglePause),document.addEventListener("visibilitychange",this._handleVisibilityChange,!1),document.addEventListener("dblclick",this._board.enterFullScreen),this._handleSwipeToFullScreen(),"undefined"!=typeof DeviceOrientationEvent&&("function"==typeof DeviceOrientationEvent.requestPermission?(btn=self._board.createMotionRequestBtn(),btn.addEventListener("click",this._requestDeviceOrientation),this._togglePause()):window.addEventListener("deviceorientation",this._handleDeviceMvmt))}_handleKeyInput(t){const e=t.code;"Space"===e&&this._togglePause(),this._snake.changeDirectionByKey(e),r.has(e)&&(this._board.removeMotionRequestBtn(),window.removeEventListener("deviceorientation",this._handleDeviceMvmt))}_handleDeviceMvmt(t){const e=t.beta,i=t.gamma;let s=this._lastBeta-e,n=this._lastGamma-i;(s>Math.abs(15)||n>Math.abs(15))&&document.removeEventListener("keydown",this._handleKeyInput);let o=this._snake.changeDirectionByMvmt(t.beta,t.gamma,15);this._lastBeta=o.newBeta,this._lastGamma=o.newGamma}_handleVisibilityChange(){document.hidden&&!this._paused&&this._togglePause()}_handleSwipeToFullScreen(){let t=0,e=0;this._board.addTouchHandlers((function(e){e.preventDefault();const i=e.changedTouches[0];t=i.screenY}),(function(i){i.preventDefault();const s=i.changedTouches[0];e=s.screenY,function(i){e<t&&t-e>10?this._board.enterFullScreen():e>t&&e-t>10?this._board.exitFullScreen():this._ended?c(i):this._togglePause()}(i)}))}_requestDeviceOrientation(){DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&this._enableMotionControl()})).catch(console.error)}_enableMotionControl(){document.removeEventListener("keydown",this._handleKeyInput),window.addEventListener("deviceorientation",this._handleDeviceMvmt),this._board.removeMotionRequestBtn(),this._togglePause()}}function l(){const t=document.getElementById("gameCanvas"),e=document.getElementById("controlPanel");let i=new n(t,e),s=new a(i.height,i.height,i.blockSize),h=o(i,s,"red","darkred");return new d(i,s,h,100)}function c(t){if("Space"===t.code||"click"===t.type||"touchend"===t.type){document.removeEventListener("keydown",c),document.removeEventListener("click",c),l().run()}}l().run();
//# sourceMappingURL=snek.min.js.map
