{"version":3,"file":"snek.min.js","sources":["../src/js/canvas.js","../src/js/board.js","../src/js/item.js","../src/js/snake.js","../src/js/game.js","../src/js/main.js"],"sourcesContent":["const CANVAS_BACKGROUND_COLOR = 'white';\r\nconst CANVAS_BORDER_COLOR = 'darkgreen';\r\nconst EXCLAMATION_BTN_COLOR = 'darkkhaki';\r\nconst GAME_TEXT_COLOR = 'gray';\r\nconst PAUSE_BTN_COLOR = 'darkgreen';\r\nconst SNAKE_BORDER_COLOR = 'darkgreen';\r\nconst SNAKE_COLOR = 'lightgreen';\r\n\r\nconst GAME_TEXT_FONT_FAMILY = '\"Saira\", serif';\r\n\r\nconst GAME_TEXT_FONT_SIZE = 50;\r\n\r\nconst PAUSE_ICON_CHAR_CODE = 0xF4BF;\r\nconst EXCLAMATION_ICON_CHAR_CODE = 0xF33A;\r\n\r\n/**\r\n * a fake contextmanager\r\n * for pixel sharpness https://stackoverflow.com/a/8696641\r\n**/\r\nfunction withStraddle(ctx, cb) {\r\n    const offset = 0.5;\r\n\r\n    try {\r\n        // turn on 'straddle' trick to avoid blurriness\r\n        ctx.translate(offset, offset);\r\n        cb();\r\n    } finally {\r\n        // turn off 'straddle' trick to avoid blurriness\r\n        ctx.translate(-offset, -offset);\r\n    }\r\n}\r\n\r\nexport function drawGame(game) {\r\n    let board = game.board;\r\n    let ctx = board.ctx;\r\n\r\n    withStraddle(ctx, () => {\r\n        // set border and background colors\r\n        ctx.filter = board.activeFilter;\r\n        ctx.fillStyle = CANVAS_BACKGROUND_COLOR;\r\n        ctx.strokeStyle = CANVAS_BORDER_COLOR;\r\n\r\n        ctx.fillRect(0, 0, board.canvas.width, board.canvas.height);\r\n\r\n        if (game.paused) {\r\n            let useExclamation = board.needsPermission();\r\n\r\n            // since filters don't work on iOS safari, we need another visual aid\r\n            // add pause button icon https://icons.getbootstrap.com/icons/pause-btn-fill/\r\n            // or exclamation triangle icon if we still need permissions\r\n            // https://icons.getbootstrap.com/icons/exclamation-triangle-fill/\r\n            ctx.font = (GAME_TEXT_FONT_SIZE * board.ratio) + 'px \"bootstrap-icons\"';\r\n            ctx.fillStyle = useExclamation ? EXCLAMATION_BTN_COLOR : PAUSE_BTN_COLOR;\r\n            ctx.fillText(String.fromCharCode(\r\n                useExclamation ? EXCLAMATION_ICON_CHAR_CODE : PAUSE_ICON_CHAR_CODE\r\n            ), 30 * board.ratio, 50 * board.ratio);\r\n        }\r\n    });\r\n}\r\n\r\nexport function drawSnake(snake, board) {\r\n    // TODO: avoid private access here\r\n    snake._body.forEach(snakePart => drawSnakePart(snakePart, board));\r\n}\r\n\r\nexport function drawItem(item, board) {\r\n    let ctx = board.ctx;\r\n\r\n    withStraddle(ctx, () => {\r\n        ctx.fillStyle = item.fill_color;\r\n        ctx.strokeStyle = item.border_color;\r\n        ctx.fillRect(item.x, item.y, board.blockSize, board.blockSize);\r\n        ctx.strokeRect(item.x, item.y, board.blockSize, board.blockSize);\r\n    });\r\n}\r\n\r\nexport function drawScore(score, board) {\r\n    let ctx = board.ctx;\r\n\r\n    ctx.font = `${GAME_TEXT_FONT_SIZE * board.ratio}px ${GAME_TEXT_FONT_FAMILY}`;\r\n    ctx.textAlign = 'center';\r\n    ctx.fillStyle = GAME_TEXT_COLOR;\r\n    ctx.fillText(score, board.canvas.width / 2, board.canvas.height / 2, board.canvas.width);\r\n}\r\n\r\nexport function drawGameEnd(board) {\r\n    let ctx = board.ctx;\r\n\r\n    ctx.font = `${GAME_TEXT_FONT_SIZE * board.ratio}px ${GAME_TEXT_FONT_FAMILY}`;\r\n    ctx.textAlign = 'center';\r\n    ctx.fillStyle = GAME_TEXT_COLOR;\r\n    ctx.fillText('DED', board.canvas.width / 2, board.canvas.height / 2, board.canvas.width);\r\n}\r\n\r\nfunction drawSnakePart(snakePart, board) {\r\n    let ctx = board.ctx;\r\n\r\n    withStraddle(ctx, () => {\r\n        ctx.fillStyle = SNAKE_COLOR;\r\n        ctx.strokeStyle = SNAKE_BORDER_COLOR;\r\n        ctx.fillRect(snakePart.x, snakePart.y, board.blockSize, board.blockSize);\r\n        ctx.strokeRect(snakePart.x, snakePart.y, board.blockSize, board.blockSize);\r\n    });\r\n}\r\n","const CTRL_PANEL_HEIGHT = 50;  // pixels\r\nconst NUM_STEPS_ACROSS_CANVAS = 30;\r\n\r\nconst NO_FILTER = 'none';\r\nconst PAUSE_FILTER = 'contrast(1.4) sepia(1)';\r\nconst ENDGAME_FILTER = 'grayscale(0.8) blur(0.5px)';\r\n\r\nconst MOTION_REQUEST_BUTTON_ID = 'motionRequest';\r\n\r\nexport class Board {\r\n    constructor(canvas, ctrlPanel) {\r\n        this._canvas = canvas;\r\n        this._ctrlPanel = ctrlPanel;\r\n\r\n        // 2d drawing context\r\n        this.ctx = this._canvas.getContext('2d');\r\n\r\n        this._boardSize = this._calculateBoardSize();\r\n\r\n        // handle rendering difference between a standard display vs a HiDPI or Retina display\r\n        this._ratio = window.devicePixelRatio || 1;\r\n\r\n        this._sizeCanvas();\r\n        this._sizeControlPanel();\r\n\r\n        this._width = canvas.width;\r\n        this._height = canvas.height;\r\n        this._blockSize = canvas.width / NUM_STEPS_ACROSS_CANVAS;\r\n\r\n        this.resetFilter();\r\n\r\n        // console.log({\r\n        //     ratio: this._ratio, 'canvas.style.width': canvas.style.width,\r\n        //     'canvas.style.height': canvas.style.height, 'canvas.width': canvas.width,\r\n        //     'canvas.height': canvas.height, block_size: this._blockSize\r\n        // })\r\n    }\r\n\r\n    get canvas() {\r\n        return this._canvas;\r\n    }\r\n\r\n    get activeFilter() {\r\n        return this._activeFilter;\r\n    }\r\n\r\n    get width() {\r\n        return this._width;\r\n    }\r\n\r\n    get height() {\r\n        return this._height;\r\n    }\r\n\r\n    get blockSize() {\r\n        return this._blockSize;\r\n    }\r\n\r\n    get ratio() {\r\n        return this._ratio;\r\n    }\r\n\r\n    resetFilter() {\r\n        this._activeFilter = NO_FILTER;\r\n    }\r\n\r\n    setEndGameFilter() {\r\n        this._activeFilter = ENDGAME_FILTER;\r\n    }\r\n\r\n    setPauseGameFilter() {\r\n        this._activeFilter = PAUSE_FILTER;\r\n    }\r\n\r\n    enterFullScreen() {\r\n        // switch to full screen\r\n        this._canvas.requestFullscreen().then(function () {\r\n            try {\r\n                // lock portrait orientation when going full screen\r\n                screen.lockOrientationUniversal = screen.lockOrientation ||\r\n                    screen.mozLockOrientation ||\r\n                    screen.msLockOrientation;\r\n                screen.lockOrientationUniversal('portrait-primary');\r\n            } catch (e) {\r\n                // console.log(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    exitFullScreen() {\r\n        document.exitFullscreen();\r\n    }\r\n\r\n    createMotionRequestBtn() {\r\n        let btn = document.createElement('button');\r\n        btn.innerHTML = 'Allow Motion Control';\r\n        btn.setAttribute('id', MOTION_REQUEST_BUTTON_ID);\r\n        btn.type = 'button';\r\n        self._ctrlPanel.appendChild(btn);\r\n        return btn;\r\n    }\r\n\r\n    removeMotionRequestBtn() {\r\n        let btn = document.getElementById(MOTION_REQUEST_BUTTON_ID);\r\n        if (btn) {\r\n            btn.parentNode.removeChild(btn);\r\n        }\r\n    }\r\n\r\n    needsPermission() {\r\n        return document.getElementById(MOTION_REQUEST_BUTTON_ID) !== null;\r\n    }\r\n\r\n    addTouchHandlers(handleTouchStart, handleTouchEnd) {\r\n        this._canvas.addEventListener('touchstart', handleTouchStart);\r\n        this._canvas.addEventListener('touchend', handleTouchEnd);\r\n    }\r\n\r\n    _calculateBoardSize() {\r\n        // take the min(width, height), find closest number divisible by desired # of total steps across the canvas,\r\n        // and use this as the width + height of the square canvas\r\n        let rawSize = Math.min(window.innerWidth, window.innerHeight) - CTRL_PANEL_HEIGHT;\r\n        let quotient = parseInt(rawSize / NUM_STEPS_ACROSS_CANVAS);\r\n\r\n        // subtracting NUM_STEPS_ACROSS_CANVAS below to allow some whitespace around the game canvas\r\n        return quotient * NUM_STEPS_ACROSS_CANVAS - NUM_STEPS_ACROSS_CANVAS;\r\n    }\r\n\r\n    _sizeCanvas() {\r\n        this._canvas.style.width = this._boardSize + 'px';\r\n        this._canvas.style.height = this._boardSize + 'px';\r\n        this._canvas.width = this._boardSize * this._ratio;\r\n        this._canvas.height = this._canvas.width;\r\n    }\r\n\r\n    _sizeControlPanel() {\r\n        this._ctrlPanel.style.width = this._boardSize + 'px';\r\n        this._ctrlPanel.style.height = CTRL_PANEL_HEIGHT + 'px';\r\n        this._ctrlPanel.width = this._boardSize * this._ratio;\r\n        this._ctrlPanel.height = CTRL_PANEL_HEIGHT * this._ratio;\r\n    }\r\n}\r\n","export function createItem(board, snake, fill_color, border_color) {\r\n    let item = {\r\n        x: randomBlock(0, board.width - board.blockSize, board.blockSize),\r\n        y: randomBlock(0, board.height - board.blockSize, board.blockSize),\r\n        fill_color: fill_color,\r\n        border_color: border_color,\r\n    };\r\n\r\n    // TODO: avoid private access here\r\n    snake._body.forEach(function isItemOnSnake(part) {\r\n        const itemIsOnSnake = part.x == item.x && part.y == item.y\r\n        if (itemIsOnSnake) item = createItem(board, snake, fill_color, border_color);\r\n    });\r\n\r\n    return item;\r\n\r\n    // TODO: constructor, getters (?)\r\n}\r\n\r\nfunction randomBlock(min, max, blockSize) {\r\n    return Math.round((Math.random() * (max-min) + min) / blockSize) * blockSize;\r\n}\r\n","export const LEFT_KEY = 'ArrowLeft';\r\nexport const RIGHT_KEY = 'ArrowRight';\r\nexport const UP_KEY = 'ArrowUp';\r\nexport const DOWN_KEY = 'ArrowDown';\r\n\r\nexport class Snake {\r\n    constructor(boardWidth, boardHeight, blockSize) {\r\n        this._body = [\r\n            { x: boardWidth / 2, y: boardHeight / 2 },\r\n            { x: boardWidth / 2 - blockSize, y: boardHeight / 2 },\r\n            { x: boardWidth / 2 - blockSize * 2, y: boardHeight / 2 },\r\n            { x: boardWidth / 2 - blockSize * 3, y: boardHeight / 2 },\r\n            { x: boardWidth / 2 - blockSize * 4, y: boardHeight / 2 },\r\n        ];\r\n\r\n        this._blockSize = blockSize;\r\n\r\n        // set initial velocity\r\n        this._dx = this._dxAtPause = blockSize;\r\n        this._dy = this._dyAtPause = 0;\r\n\r\n        this.isChangingDirection = false;\r\n    }\r\n\r\n    advanceHead() {\r\n        const head = {x: this._body[0].x + this._dx, y: this._body[0].y + this._dy};\r\n        this._body.unshift(head);\r\n\r\n        // console.log(`HEAD: ${head.x}, ${head.y}`);\r\n    }\r\n\r\n    advanceTail() {\r\n        this._body.pop();\r\n    }\r\n\r\n    pause() {\r\n        // save velocity at pause\r\n        this._dxAtPause = this._dx;\r\n        this._dyAtPause = this._dy;\r\n        // set velocity to 0\r\n        this._dx = this._dy = 0;\r\n    }\r\n\r\n    unpause() {\r\n        // set velocity to state before pause\r\n        this._dx = this._dxAtPause;\r\n        this._dy = this._dyAtPause;\r\n    }\r\n\r\n    didEat(item) {\r\n        return this._body[0].x === item.x && this._body[0].y === item.y;\r\n    }\r\n\r\n    didCollide(boardWidth, boardHeight, blockSize) {\r\n        // test whether the snake collided with itself\r\n        // loop starts at index 4 because it is impossible for the first three parts to touch each other\r\n        for (let i = 4; i < this._body.length; i++) {\r\n            const didCollide = this._body[i].x === this._body[0].x && this._body[i].y === this._body[0].y;\r\n            if (didCollide) { return true; }\r\n            // TODO: if purple phase is available, decrement and continue game\r\n        }\r\n\r\n        const hitLeftWall = this._body[0].x < 0;\r\n        const hitRightWall = this._body[0].x > boardWidth - blockSize;\r\n        const hitTopWall = this._body[0].y < 0;\r\n        const hitBottomWall = this._body[0].y > boardHeight - blockSize;\r\n\r\n        return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;\r\n        // TODO: if blue teleport is available, decrement, teleport, and continue game\r\n    }\r\n\r\n    changeDirectionByKey(keyPressed) {\r\n        if (this.isChangingDirection) { return; }\r\n        this.isChangingDirection = true;\r\n\r\n        const goingUp = this._dy === -this._blockSize;\r\n        const goingDown = this._dy === this._blockSize;\r\n        const goingRight = this._dx === this._blockSize;\r\n        const goingLeft = this._dx === -this._blockSize;\r\n\r\n        if (keyPressed === LEFT_KEY && !goingRight) { this._dx = -this._blockSize; this._dy = 0; }\r\n        if (keyPressed === UP_KEY && !goingDown) { this._dx = 0; this._dy = -this._blockSize; }\r\n        if (keyPressed === RIGHT_KEY && !goingLeft) { this._dx = this._blockSize; this._dy = 0; }\r\n        if (keyPressed === DOWN_KEY && !goingUp) { this._dx = 0; this._dy = this._blockSize; }\r\n    }\r\n\r\n    changeDirectionByMvmt(beta, gamma, lastBeta, lastGamma, sensitivity) {\r\n        if (this.isChangingDirection) {\r\n            return {\r\n                newBeta: lastBeta,\r\n                newGamma: lastGamma\r\n            };\r\n        }\r\n        this.isChangingDirection = true;\r\n\r\n        const betaDelta = lastBeta - beta;\r\n        const gammaDelta = lastGamma - gamma;\r\n\r\n        const goingUp = this._dy === -this._blockSize;\r\n        const goingDown = this._dy === this._blockSize;\r\n        const goingRight = this._dx === this._blockSize;\r\n        const goingLeft = this._dx === -this._blockSize;\r\n\r\n        let newBeta, newGamma;\r\n        if (betaDelta < -sensitivity) {\r\n            if (!goingUp) { dir = 'DOWN'; this._dx = 0; this._dy = this._blockSize; newGamma = gamma; }\r\n            newBeta = beta;\r\n        } else if (betaDelta > sensitivity) {\r\n            if (!goingDown) { dir = 'UP'; this._dx = 0; this._dy = -this._blockSize; newGamma = gamma; }\r\n            newBeta = beta;\r\n        } else if (gammaDelta < -sensitivity) {\r\n            if (!goingLeft) { dir = 'RIGHT'; this._dx = this._blockSize; this._dy = 0; newBeta = beta; }\r\n            newGamma = gamma;\r\n        } else if (gammaDelta > sensitivity) {\r\n            if (!goingRight) { dir = 'LEFT'; this._dx = -this._blockSize; this._dy = 0; newBeta = beta; }\r\n            newGamma = gamma;\r\n        }\r\n\r\n        // if (dir) {\r\n        //     console.log(`going${dir}`);\r\n        // }\r\n\r\n        return {\r\n            newBeta: newBeta,\r\n            newGamma: newGamma\r\n        };\r\n    }\r\n}\r\n","import { drawGame, drawGameEnd, drawItem, drawScore, drawSnake } from './canvas.js';\r\nimport { Board } from './board.js';\r\nimport { createItem } from './item.js';\r\nimport { Snake, LEFT_KEY, RIGHT_KEY, UP_KEY, DOWN_KEY } from './snake.js';\r\n\r\nconst FOOD_COLOR = 'red';\r\nconst FOOD_BORDER_COLOR = 'darkred';\r\n\r\nconst CANVAS_ID = 'gameCanvas';\r\nconst CONTROL_PANEL_ID = 'controlPanel';\r\n\r\nconst GAME_SPEED = 100;  // milliseconds\r\nconst SCORE_INCREMENT = 10;\r\nconst SWIPE_SENSITIVITY = 10;  // delta of pixels needed to consider touch mvmt a 'swipe'\r\nconst MOTION_SENSITIVITY = 15;  // degree of motion needed to consider a device mvmt as intentional\r\n\r\nconst SPACE_KEY = 'Space';\r\nconst ARROW_KEYS = new Set([LEFT_KEY, RIGHT_KEY, UP_KEY, DOWN_KEY]);\r\n\r\n// TODO: can this go back into Game ?\r\n// this helps with lag\r\n// but there's a subtle bug with it where if the user doesn't play, we assume motion\r\n// is available, so on game end they cannot restart with space bar\r\nlet MOTION_AVAILABLE = false;\r\n\r\nexport class Game {\r\n    constructor(board, snake, food, speed) {\r\n        this._board = board;\r\n        this._snake = snake;\r\n        this._food = food;\r\n        this._score = 0;\r\n        this._paused = false;\r\n        this._ended = false;\r\n        this._speed = speed;\r\n        this._lastBeta = 0;\r\n        this._lastGamma = 0;\r\n\r\n        this._setupControls();\r\n    }\r\n\r\n    get board() {\r\n        return this._board;\r\n    }\r\n\r\n    get snake() {\r\n        return this._snake;\r\n    }\r\n\r\n    get food() {\r\n        return this._food;\r\n    }\r\n\r\n    get speed() {\r\n        return this._speed;\r\n    }\r\n\r\n    get score() {\r\n        return this._score;\r\n    }\r\n\r\n    get activeFilter() {\r\n        return this._activeFilter;\r\n    }\r\n\r\n    get paused() {\r\n        return this._paused;\r\n    }\r\n\r\n    run() {\r\n        if (this._didEnd()) { this._end(); return; }\r\n\r\n        let timeout = setTimeout(() => {\r\n            this._snake.isChangingDirection = false;\r\n\r\n            drawGame(this);\r\n            drawScore(this._score, this._board);\r\n            drawItem(this._food, this._board);\r\n            if (!this._paused) {\r\n                //console.log(`paused: ${this._paused}. advancing...`);\r\n                this._advanceSnake();\r\n            }\r\n            drawSnake(this._snake, this._board);\r\n\r\n            // run game loop again\r\n            this.run();\r\n        }, this._speed);\r\n\r\n        if (!this._timeout) this._timeout = timeout;\r\n    }\r\n\r\n    _advanceSnake() {\r\n        this._snake.advanceHead();\r\n\r\n        if (this._snake.didEat(this._food)) {\r\n            this._score += SCORE_INCREMENT;\r\n            // TODO: at SCORE_THRESHOLDs, enable teleporting -- then phasing\r\n                // TELEPORT_THRESHOLD: 50\r\n                // PHASING_THRESHOLD: 150\r\n                // maybe higher threshold with arrow controls (easier game)?\r\n                // how often should each drop?\r\n                    // perhaps it always drops AT threshold, then gets random\r\n                // should they drop after eating or on random ticks (preferred)?\r\n            let newFood = createItem(this._board, this._snake, FOOD_COLOR, FOOD_BORDER_COLOR);\r\n\r\n            this._food = newFood;\r\n        } else {\r\n            this._snake.advanceTail();\r\n        }\r\n    }\r\n\r\n    _didEnd() {\r\n        return this._snake.didCollide(this._board.width, this._board.height, this._board.blockSize);\r\n    }\r\n\r\n    _end() {\r\n        this._ended = true;\r\n        this._board.setEndGameFilter();\r\n\r\n        drawGame(this);\r\n        drawItem(this._food, this._board);\r\n        drawSnake(this._snake, this._board);\r\n\r\n        drawGameEnd(this._board);\r\n\r\n        // allow for game restart\r\n\r\n        //if (!MOTION_AVAILABLE) {\r\n            document.removeEventListener('keydown', this._handleKeyInput);\r\n            document.addEventListener('keydown', restartGame);\r\n        //}\r\n        document.removeEventListener('click', this._togglePause);\r\n        document.addEventListener('click', restartGame);\r\n    }\r\n\r\n    _togglePause() {\r\n        this._paused = !this._paused;\r\n\r\n        //console.log(`paused: ${this._paused}`);\r\n\r\n        if (this._paused) {\r\n            this._snake.pause();\r\n            this._board.setPauseGameFilter();\r\n        } else {\r\n            this._snake.unpause();\r\n            this._board.resetFilter();\r\n        }\r\n    }\r\n\r\n    _setupControls() {\r\n        this._lastBeta = this._lastGamma = 0;\r\n\r\n        this._handleDeviceMvmt = this._handleDeviceMvmt.bind(this);\r\n        this._handleKeyInput = this._handleKeyInput.bind(this);\r\n        this._handleVisibilityChange = this._handleVisibilityChange.bind(this);\r\n        this._requestDeviceOrientation = this._requestDeviceOrientation.bind(this);\r\n        this._togglePause = this._togglePause.bind(this);\r\n        this._board.enterFullScreen = this._board.enterFullScreen.bind(this._board);\r\n\r\n        // call change direction on key press\r\n        document.addEventListener('keydown', this._handleKeyInput);\r\n\r\n        // pause game on click or if game becomes hidden\r\n        document.addEventListener('click', this._togglePause);\r\n        document.addEventListener('visibilitychange', this._handleVisibilityChange, false);\r\n\r\n        // enter full screen on double click (for devices that support this event)\r\n        document.addEventListener('dblclick', this._board.enterFullScreen);\r\n\r\n        // enter full screen on swipe (for touch/mobile devices)\r\n        this._handleSwipeToFullScreen();\r\n\r\n        if ( typeof(DeviceOrientationEvent) !== 'undefined' ) {\r\n            //MOTION_AVAILABLE = true;\r\n\r\n            // if browser (e.g., iOS safari) requires permission for deviceorientation, request it\r\n            if ( typeof(DeviceOrientationEvent.requestPermission) === 'function' ) {\r\n                btn = self._board.createMotionRequestBtn();\r\n                btn.addEventListener('click', this._requestDeviceOrientation);\r\n\r\n                // give user time to grant permission\r\n                this._togglePause();\r\n            }\r\n            else {\r\n                window.addEventListener('deviceorientation', this._handleDeviceMvmt);\r\n            }\r\n        }\r\n    }\r\n\r\n    _handleKeyInput(event) {\r\n        const keyPressed = event.code;\r\n\r\n        if (keyPressed === SPACE_KEY) {\r\n            this._togglePause();\r\n        }\r\n\r\n        this._snake.changeDirectionByKey(keyPressed);\r\n\r\n        if (ARROW_KEYS.has(keyPressed)) {\r\n            // once user starts using arrow controls, disable motion control, as having\r\n            // both keyboard and motion event listeners makes the game less responsive\r\n            this._board.removeMotionRequestBtn();\r\n            window.removeEventListener('deviceorientation', this._handleDeviceMvmt);\r\n            //MOTION_AVAILABLE = false;\r\n        }\r\n    }\r\n\r\n    _handleDeviceMvmt(event) {\r\n        // forward (positive) to backward (negative) motion of the device\r\n        const beta = event.beta;\r\n        // right (positive) to left (negative) motion of the device\r\n        const gamma = event.gamma;\r\n\r\n        // console.log('deviceorientation', {\r\n        //     beta: event.beta, last_beta: this._lastBeta, beta_delta: betaDelta,\r\n        //     gamma: event.gamma, last_gamma: this._lastGamma, gamma_delta: gammaDelta,\r\n        // });\r\n\r\n        let betaDelta = this._lastBeta - beta;\r\n        let gammaDelta = this._lastGamma - gamma;\r\n\r\n        if (betaDelta > Math.abs(MOTION_SENSITIVITY) || gammaDelta > Math.abs(MOTION_SENSITIVITY)) {\r\n            // once user starts using motion control, disable keyboard controls, as having\r\n            // both keyboard and motion event listeners makes the game less responsive\r\n            document.removeEventListener('keydown', this._handleKeyInput);\r\n        }\r\n\r\n        let newMvmt = this._snake.changeDirectionByMvmt(event.beta, event.gamma, MOTION_SENSITIVITY);\r\n\r\n        this._lastBeta = newMvmt.newBeta;\r\n        this._lastGamma = newMvmt.newGamma;\r\n    }\r\n\r\n    _handleVisibilityChange() {\r\n        if (document.hidden && !this._paused) {\r\n            this._togglePause();\r\n        }\r\n    }\r\n\r\n    _handleSwipeToFullScreen() {\r\n        let downY = 0;\r\n        let upY = 0;\r\n\r\n        function handleGesture(ev) {\r\n            if (upY < downY && downY - upY > SWIPE_SENSITIVITY) {\r\n                // console.log(`swiped UP ${downY-upY}px`);\r\n                this._board.enterFullScreen();\r\n            } else if (upY > downY && upY - downY > SWIPE_SENSITIVITY) {\r\n                // console.log(`swiped DOWN ${upY-downY}px`);\r\n                this._board.exitFullScreen();\r\n            } else if (this._ended) {\r\n                restartGame(ev);\r\n            } else {\r\n                this._togglePause();\r\n            }\r\n        }\r\n\r\n        function handleTouchStart(ev) {\r\n            ev.preventDefault();\r\n\r\n            const firstTouch = ev.changedTouches[0];\r\n            // console.log({\r\n            //     [ev.type]: (firstTouch.screenX, firstTouch.screenY)\r\n            // });\r\n            // downX = firstTouch.screenX;\r\n\r\n            downY = firstTouch.screenY;\r\n        }\r\n\r\n        function handleTouchEnd(ev) {\r\n            ev.preventDefault();\r\n\r\n            const firstTouch = ev.changedTouches[0];\r\n            // console.log({\r\n            //     [ev.type]: (firstTouch.screenX, firstTouch.screenY)\r\n            // });\r\n            // upX = firstTouch.screenX;\r\n\r\n            upY = firstTouch.screenY;\r\n\r\n            handleGesture(ev);\r\n        }\r\n\r\n        this._board.addTouchHandlers(handleTouchStart, handleTouchEnd);\r\n    }\r\n\r\n    _requestDeviceOrientation() {\r\n        DeviceOrientationEvent.requestPermission()\r\n            .then( response => {\r\n            if ( response === 'granted' ) {\r\n                this._enableMotionControl();\r\n            }\r\n        })\r\n            .catch( console.error )\r\n    }\r\n\r\n    /**\r\n     * disable keyboard, enable motion, remove button,\r\n     * and un-pause game\r\n     */\r\n    _enableMotionControl() {\r\n        document.removeEventListener('keydown', this._handleKeyInput);\r\n        window.addEventListener('deviceorientation', this._handleDeviceMvmt);\r\n        this._board.removeMotionRequestBtn();\r\n        this._togglePause();\r\n    }\r\n}\r\n\r\n// <!-- GAME EXECUTION HELPERS BELOW -->\r\n\r\nexport function initGame() {\r\n    const canvas = document.getElementById(CANVAS_ID);\r\n    const ctrl_panel = document.getElementById(CONTROL_PANEL_ID);\r\n\r\n    let board = new Board(canvas, ctrl_panel);\r\n    let snake = new Snake(board.height, board.height, board.blockSize);\r\n    let food = createItem(board, snake, FOOD_COLOR, FOOD_BORDER_COLOR);\r\n\r\n    let game = new Game(board, snake, food, GAME_SPEED);\r\n\r\n    return game;\r\n}\r\n\r\nfunction restartGame(event) {\r\n    if (event.code === SPACE_KEY || event.type === 'click' || event.type === 'touchend') {\r\n\r\n        //if (!MOTION_AVAILABLE) {\r\n            document.removeEventListener('keydown', restartGame);\r\n        //}\r\n        document.removeEventListener('click', restartGame);\r\n\r\n        let game = initGame();\r\n        game.run();\r\n    }\r\n}\r\n","import { initGame } from './game.js'\r\n\r\nlet game = initGame();\r\ngame.run();\r\n"],"names":["withStraddle","ctx","cb","offset","translate","drawGame","game","board","filter","activeFilter","fillStyle","strokeStyle","fillRect","canvas","width","height","paused","useExclamation","needsPermission","font","ratio","fillText","String","fromCharCode","drawSnake","snake","_body","forEach","snakePart","x","y","blockSize","strokeRect","drawSnakePart","drawItem","item","fill_color","border_color","Board","constructor","ctrlPanel","this","_canvas","_ctrlPanel","getContext","_boardSize","_calculateBoardSize","_ratio","window","devicePixelRatio","_sizeCanvas","_sizeControlPanel","_width","_height","_blockSize","resetFilter","_activeFilter","setEndGameFilter","setPauseGameFilter","enterFullScreen","requestFullscreen","then","screen","lockOrientationUniversal","lockOrientation","mozLockOrientation","msLockOrientation","e","exitFullScreen","document","exitFullscreen","createMotionRequestBtn","btn","createElement","innerHTML","setAttribute","type","self","appendChild","removeMotionRequestBtn","getElementById","parentNode","removeChild","addTouchHandlers","handleTouchStart","handleTouchEnd","addEventListener","rawSize","Math","min","innerWidth","innerHeight","parseInt","style","CTRL_PANEL_HEIGHT","createItem","randomBlock","part","max","round","random","Snake","boardWidth","boardHeight","_dx","_dxAtPause","_dy","_dyAtPause","isChangingDirection","advanceHead","head","unshift","advanceTail","pop","pause","unpause","didEat","didCollide","i","length","hitLeftWall","hitRightWall","hitTopWall","hitBottomWall","changeDirectionByKey","keyPressed","goingUp","goingDown","goingRight","goingLeft","changeDirectionByMvmt","beta","gamma","lastBeta","lastGamma","sensitivity","newBeta","newGamma","betaDelta","gammaDelta","dir","ARROW_KEYS","Set","Game","food","speed","_board","_snake","_food","_score","_paused","_ended","_speed","_lastBeta","_lastGamma","_setupControls","score","run","_didEnd","_end","timeout","setTimeout","textAlign","drawScore","_advanceSnake","_timeout","newFood","drawGameEnd","removeEventListener","_handleKeyInput","restartGame","_togglePause","_handleDeviceMvmt","bind","_handleVisibilityChange","_requestDeviceOrientation","_handleSwipeToFullScreen","DeviceOrientationEvent","event","code","has","abs","newMvmt","hidden","downY","upY","ev","preventDefault","firstTouch","changedTouches","screenY","handleGesture","requestPermission","response","_enableMotionControl","catch","console","error","initGame","ctrl_panel"],"mappings":"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"}