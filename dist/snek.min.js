/*! BuildToolsCookbook v2.0.0 | (c) 2022 iconix | MIT License | http://github.com/cferdinandi/build-tools-boilerplate */
function t(t,e){const i=.5;try{t.translate(i,i),e()}finally{t.translate(-.5,-.5)}}function e(e){let i=e.board,s=i.ctx;t(s,(()=>{if(s.filter=i.activeFilter,s.fillStyle=i.color,i.isGlowing?(i.canvas.style.border="none",i.canvas.style.outline=`${i.borderColor} dashed thin`,i.canvas.style.boxShadow=`0 0 10px ${i.color}`,i.canvas.style.transition="box-shadow linear 1s"):(i.canvas.style.border=`2px solid ${i.borderColor}`,i.canvas.style.outline="none",i.canvas.style.boxShadow="none",i.canvas.style.transition="box-shadow linear 0.5s"),s.fillRect(0,0,i.canvas.width,i.canvas.height),e.paused){let t=i.needsPermission();s.font=50*i.ratio+'px "bootstrap-icons"',s.fillStyle="darkkhaki",s.fillText(String.fromCharCode(t?62266:62655),30*i.ratio,50*i.ratio,i.canvas.width)}}))}function i(e,i){e.body.forEach((s=>function(e,i,s,n,o){let r=o.ctx;t(r,(()=>{r.fillStyle=i,r.strokeStyle=s,n&&(r.lineCap="round",r.shadowBlur=18,r.shadowColor=i),r.fillRect(e.x,e.y,o.blockSize,o.blockSize),r.strokeRect(e.x,e.y,o.blockSize,o.blockSize),n&&(r.lineCap="butt",r.shadowBlur=0)}))}(s,e.color,e.borderColor,e.isGlowing,i)))}function s(e,i){let s=i.ctx;t(s,(()=>{s.fillStyle=e.fillColor,s.strokeStyle=e.borderColor,s.fillRect(e.x,e.y,i.blockSize,i.blockSize),s.strokeRect(e.x,e.y,i.blockSize,i.blockSize)}))}class n{constructor(t,e){if(this._canvas=t,this._ctrlPanel=e,!(this.ctx=this._canvas.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");this._boardSize=this._calculateBoardSize(),this._ratio=window.devicePixelRatio||1,this._sizeCanvas(),this._sizeControlPanel(),this._width=t.width,this._height=t.height,this._blockSize=t.width/30,this._activeFilter="none",this._color="white",this._borderColor="darkgreen",this._isGlowing=!1,this.resetFilter()}get canvas(){return this._canvas}get color(){return this._color}get borderColor(){return this._borderColor}get isGlowing(){return this._isGlowing}get activeFilter(){return this._activeFilter}get width(){return this._width}get height(){return this._height}get blockSize(){return this._blockSize}get ratio(){return this._ratio}resetFilter(){this._activeFilter="none"}setEndGameFilter(){this._activeFilter="grayscale(0.8) blur(0.5px)"}setPauseGameFilter(){this._activeFilter="contrast(1.4) sepia(1)"}enterFullScreen(){this._canvas.requestFullscreen().then((function(){try{screen.lockOrientationUniversal=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation,screen.lockOrientationUniversal("portrait-primary")}catch(t){}}))}exitFullScreen(){document.exitFullscreen()}createMotionRequestBtn(){let t=document.createElement("button");return t.innerHTML="Allow Motion Control",t.setAttribute("id","motionRequest"),t.type="button",this._ctrlPanel.appendChild(t),t}removeMotionRequestBtn(){let t=document.getElementById("motionRequest");t?.parentNode?.removeChild(t)}setGlow(t){t&&!this._isGlowing&&(this._color="#e2f1fa",this._borderColor="blue",this._isGlowing=!0),!t&&this._isGlowing&&(this._color="white",this._borderColor="darkgreen",this._isGlowing=!1)}needsPermission(){return null!==document.getElementById("motionRequest")}addTouchHandlers(t,e){this._handleTouchStart=t,this._handleTouchEnd=e,this._canvas.addEventListener("touchstart",t),this._canvas.addEventListener("touchend",e)}removeTouchHandlers(){this._handleTouchStart&&this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._handleTouchEnd&&this._canvas.removeEventListener("touchend",this._handleTouchEnd)}_calculateBoardSize(){return 30*((Math.min(window.innerWidth,window.innerHeight)-50)/30)-30}_sizeCanvas(){this._canvas.style.width=this._boardSize+"px",this._canvas.style.height=this._boardSize+"px",this._canvas.width=this._boardSize*this._ratio,this._canvas.height=this._canvas.width}_sizeControlPanel(){this._ctrlPanel.style.width=this._boardSize+"px",this._ctrlPanel.style.height="50px"}}class o{constructor(t,e){this._x=Number.MIN_SAFE_INTEGER,this._y=Number.MIN_SAFE_INTEGER,this._generate(t,e)}get x(){return this._x}get y(){return this._y}get type(){return"UNKNOWN_ITEM"}get fillColor(){return""}get borderColor(){return""}_generate(t,e){this._x=this._randomBlock(0,t.width-t.blockSize,t.blockSize),this._y=this._randomBlock(0,t.height-t.blockSize,t.blockSize),e.body.forEach((i=>{i.x==this._x&&i.y==this._y&&this._generate(t,e)}))}_randomBlock(t,e,i){return Math.round((Math.random()*(e-t)+t)/i)*i}}class r extends o{get type(){return"FOOD"}get fillColor(){return"red"}get borderColor(){return"darkred"}}class h extends o{get type(){return"TELEPORT"}get fillColor(){return"blue"}get borderColor(){return"darkblue"}}class a extends o{get type(){return"PHASE"}get fillColor(){return"orchid"}get borderColor(){return"violet"}}const l={none:null,food:r,teleport:h,phase:a};function d(t,e,i,s){let n=0,o=0,r=0,d=0;return 50==t?i&&(r=1):150==t?i&&(d=1):t>50&&!e[h]&&(r=s?.01:.1),t>150&&!e[a]&&(d=s?.01:.1),i?o=1-r-d:(o=.01,n=1-r-d-o),l[function(t,e){const i=Object.keys(t);return i.find(((s,n)=>{const o=i.slice(0,n+1).reduce(((e,i)=>e+t[i]),0);return e<o}))}({none:n,food:o,teleport:r,phase:d},Math.random())]}class _{constructor(t,e,i){this._body=[{x:t/2,y:e/2},{x:t/2-i,y:e/2},{x:t/2-2*i,y:e/2},{x:t/2-3*i,y:e/2},{x:t/2-4*i,y:e/2}],this._blockSize=i,this._dx=this._dxAtPause=i,this._dy=this._dyAtPause=0,this._color="lightgreen",this._borderColor="darkgreen",this._isGlowing=!1,this.isChangingDirection=!1,this.powerUps={[h]:!1,[a]:!1}}get body(){return this._body}get color(){return this._color}get borderColor(){return this._borderColor}get isGlowing(){return this._isGlowing}advanceHead(){const t={x:this._body[0].x+this._dx,y:this._body[0].y+this._dy};this._body.unshift(t)}advanceTail(){this._body.pop()}pause(){this._dxAtPause=this._dx,this._dyAtPause=this._dy,this._dx=this._dy=0}unpause(){this._dx=this._dxAtPause,this._dy=this._dyAtPause}didEat(t){return this._round(this._body[0].x,0)===this._round(t.x,0)&&this._round(this._body[0].y,0)===this._round(t.y,0)}equip(t){t instanceof h&&(this.powerUps[h]=!0),t instanceof a&&(this.powerUps[a]=!0,this.setGlow(!0))}setGlow(t){t&&!this._isGlowing&&(this._borderColor="violet",this._isGlowing=!0),!t&&this._isGlowing&&(this._borderColor="darkgreen",this._isGlowing=!1)}didCollide(t,e,i){for(let t=4;t<this._body.length;t++){if(this._body[t].x===this._body[0].x&&this._body[t].y===this._body[0].y)return!this.powerUps[a]||(this.powerUps[a]=!1,this.setGlow(!1),!1)}const s=this._body[0].x<0,n=this._body[0].x>t-i,o=this._body[0].y<0,r=this._body[0].y>e-i;return!!(s||n||o||r)&&(!this.powerUps[h]||(this.powerUps[h]=!1,s?this._body[0].x=t:n?this._body[0].x=-i:o?this._body[0].y=e:r&&(this._body[0].y=-i),!1))}changeDirectionByKey(t){if(this.isChangingDirection)return;this.isChangingDirection=!0;const e=this._dy===-this._blockSize,i=this._dy===this._blockSize,s=this._dx===this._blockSize,n=this._dx===-this._blockSize;"ArrowLeft"!==t||s||(this._dx=-this._blockSize,this._dy=0),"ArrowUp"!==t||i||(this._dx=0,this._dy=-this._blockSize),"ArrowRight"!==t||n||(this._dx=this._blockSize,this._dy=0),"ArrowDown"!==t||e||(this._dx=0,this._dy=this._blockSize)}changeDirectionByMvmt(t,e,i,s,n){let o=i,r=s;if(this.isChangingDirection)return{newBeta:o,newGamma:r};this.isChangingDirection=!0;const h=i-t,a=s-e,l=this._dy===-this._blockSize,d=this._dy===this._blockSize,_=this._dx===this._blockSize,c=this._dx===-this._blockSize;return h<-n?(l||(this._dx=0,this._dy=this._blockSize,r=e),o=t):h>n?(d||(this._dx=0,this._dy=-this._blockSize,r=e),o=t):a<-n?(c||(this._dx=this._blockSize,this._dy=0,o=t),r=e):a>n&&(_||(this._dx=-this._blockSize,this._dy=0,o=t),r=e),{newBeta:o,newGamma:r}}_round(t,e=1){var i=Math.pow(10,e||0);return Math.round(t*i)/i}}const c=new Set(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Space"]);class u{constructor(t,e,i,s){this._board=t,this._snake=e,this._item=i,this._score=0,this._highScore=parseInt(localStorage.getItem("highScore")||"0"),this._paused=!1,this._ended=!1,this._speed=parseInt(localStorage.getItem("gameSpeed")||s.toString()),this._motionAvailable=null,this._lastBeta=0,this._lastGamma=0,this._setupControls()}get board(){return this._board}get snake(){return this._snake}get item(){return this._item}get speed(){return this._speed}get score(){return this._score}get highScore(){return this._highScore}get paused(){return this._paused}run(){if(this._didEnd())return void this._end();let t=setTimeout((()=>{this._snake.isChangingDirection=!1,e(this),function(t,e){let i=e.ctx;i.font=50*e.ratio+'px "Saira", serif',i.textAlign="center",i.fillStyle="gray",i.fillText(t.toString(),e.canvas.width/2,e.canvas.height/2-25,e.canvas.width)}(this._score,this._board),function(t,e){let i=e.ctx;i.font=50*e.ratio+'px "Saira", serif',i.textAlign="center",i.strokeStyle="goldenrod",i.strokeText(t.toString(),e.canvas.width/2,e.canvas.height/2+25,e.canvas.width)}(this._highScore,this._board),s(this._item,this._board),this._paused||this._advanceSnake(),i(this._snake,this._board),this.run()}),this._speed);this._timeout||(this._timeout=t)}_advanceSnake(){if(this._snake.advanceHead(),this._snake.didEat(this._item)){this._score+=10,this._snake.equip(this._item),this._board.setGlow(this._snake.powerUps[h]);let t=d(this._score,this._snake.powerUps,!0,!1);null!==t&&(this._item=new t(this._board,this._snake))}else{if(this._score>=100||this._item instanceof h||this._item instanceof a){let t=d(this._score,this._snake.powerUps,!1,!0);null!==t&&(this._item=new t(this._board,this._snake))}this._snake.advanceTail()}}_didEnd(){const t=this._snake.didCollide(this._board.width,this._board.height,this._board.blockSize);return this._board.setGlow(this._snake.powerUps[h]),t}_end(){this._ended=!0,this._board.setEndGameFilter(),e(this),s(this._item,this._board),i(this._snake,this._board),function(t){let e=t.ctx;e.font=50*t.ratio+'px "Saira", serif',e.textAlign="center",e.fillStyle="gray",e.fillText("DED",t.canvas.width/2,t.canvas.height/2,t.canvas.width)}(this._board),this.score>this._highScore&&(this._highScore=this._score,localStorage.setItem("highScore",this._score.toString())),localStorage.setItem("gameSpeed",this._speed.toString()),this._restart=this._restart.bind(this),this._motionAvailable||document.removeEventListener("keydown",this._handleKeyInput),document.addEventListener("keydown",this._restart),document.removeEventListener("click",this._togglePause),document.addEventListener("click",this._restart)}_restart(t){(t instanceof KeyboardEvent&&"Space"===t.code||"click"===t.type||"touchend"===t.type)&&(document.removeEventListener("keydown",this._restart),document.removeEventListener("click",this._restart),this._board.removeTouchHandlers(),g().run())}_togglePause(){this._paused=!this._paused,this._paused?(this._snake.pause(),this._board.setPauseGameFilter()):(this._snake.unpause(),this._board.resetFilter())}_setupControls(){if(this._lastBeta=this._lastGamma=0,this._handleDeviceMvmt=this._handleDeviceMvmt.bind(this),this._handleKeyInput=this._handleKeyInput.bind(this),this._handleVisibilityChange=this._handleVisibilityChange.bind(this),this._requestDeviceOrientation=this._requestDeviceOrientation.bind(this),this._togglePause=this._togglePause.bind(this),this._board.enterFullScreen=this._board.enterFullScreen.bind(this._board),document.addEventListener("keydown",this._handleKeyInput),document.addEventListener("click",this._togglePause),document.addEventListener("visibilitychange",this._handleVisibilityChange,!1),document.addEventListener("dblclick",this._board.enterFullScreen),this._handleSwipeToFullScreen(),"undefined"!=typeof DeviceOrientationEvent)if("function"==typeof DeviceOrientationEvent.requestPermission){this._board.createMotionRequestBtn().addEventListener("click",this._requestDeviceOrientation),this._togglePause()}else window.addEventListener("deviceorientation",this._handleDeviceMvmt)}_handleKeyInput(t){const e=t.code;c.has(e)&&(null!=this._motionAvailable||this._ended||console.log("key controls activated"),this._board.removeMotionRequestBtn(),window.removeEventListener("deviceorientation",this._handleDeviceMvmt),this._speed=100,this._motionAvailable=!1),"Space"===e&&this._togglePause(),this._snake.changeDirectionByKey(e)}_handleDeviceMvmt(t){const e=t.beta||0,i=t.gamma||0;let s=this._lastBeta-e,n=this._lastGamma-i;null==this._motionAvailable&&(s>Math.abs(15)||n>Math.abs(15))&&(document.removeEventListener("keydown",this._handleKeyInput),this._speed=125,this._motionAvailable=!0,console.log("motion controls activated"));let o=this._snake.changeDirectionByMvmt(e,i,this._lastBeta,this._lastGamma,15);this._lastBeta=o.newBeta,this._lastGamma=o.newGamma}_handleVisibilityChange(){document.hidden&&!this._paused&&this._togglePause()}_handleSwipeToFullScreen(){let t=0,e=0,i=this;this._board.addTouchHandlers((function(e){e.preventDefault();const i=e.changedTouches[0];t=i.screenY}),(function(s){s.preventDefault();const n=s.changedTouches[0];e=n.screenY,function(s){e<t&&t-e>10?i._board.enterFullScreen():e>t&&e-t>10?i._board.exitFullScreen():i._ended?i._restart(s):i._togglePause()}(s)}))}_requestDeviceOrientation(){DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&this._enableMotionControl()})).catch(console.error)}_enableMotionControl(){document.removeEventListener("keydown",this._handleKeyInput),window.addEventListener("deviceorientation",this._handleDeviceMvmt),this._board.removeMotionRequestBtn(),this._togglePause()}}function g(){let t,e;if(!(t=document.getElementById("gameCanvas")))throw new Error("canvas not found");if(!(t instanceof HTMLCanvasElement))throw new Error("#gameCanvas element is not an HTML canvas");if(!(e=document.getElementById("controlPanel")))throw new Error("ctrl panel not found");let i=new n(t,e),s=new _(i.height,i.height,i.blockSize),o=new r(i,s);return new u(i,s,o,100)}g().run();
//# sourceMappingURL=snek.min.js.map
