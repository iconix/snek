/*! snek v1.5.0 | (c) 2024 iconix | MIT License | https://github.com/iconix/snek */
const e={BOARD:{CTRL_PANEL_HEIGHT:50,MARGIN_SIZE:20,NUM_STEPS_ACROSS_CANVAS:30,DEFAULT_BACKGROUND_COLOR:"white",DEFAULT_BORDER_COLOR:"darkgreen",TELEPORT_BORDER_COLOR:"blue",TELEPORT_BACKGROUND_COLOR:"#e2f1fa",FILTERS:{NONE:"none",PAUSE:"contrast(1.4) sepia(1)",ENDGAME:"grayscale(0.8) blur(0.5px)"}},SNAKE:{INITIAL_LENGTH:5,DEFAULT_COLOR:"lightgreen",DEFAULT_BORDER_COLOR:"darkgreen",PHASE_BORDER_COLOR:"violet"},ITEM:{FOOD_COLOR:"red",FOOD_BORDER_COLOR:"darkred",PHASE_COLOR:"orchid",PHASE_BORDER_COLOR:"violet",TELEPORT_COLOR:"blue",TELEPORT_BORDER_COLOR:"darkblue",PHASE_SCORE_THRESHOLD:150,TELEPORT_SCORE_THRESHOLD:50,BASE_PHASE_PROBABILITY:.1,BASE_TELEPORT_PROBABILITY:.1,BASE_VOLATILE_FOOD_PROBABILITY:.01},GAME:{SCORE_INCREMENT:10,SCORE_THRESHOLD_FOR_VOLATILE_FOOD:100},INPUT:{GAME_SPEED_MS__ARROW:100,GAME_SPEED_MS__MOTION:125,SWIPE_SENSITIVITY:10,MOTION_SENSITIVITY:15,MOTION_THROTTLE_TIME_MS:100},CANVAS:{GAME_TEXT_COLOR:"gray",HIGH_SCORE_TEXT_COLOR:"goldenrod",PAUSE_BTN_COLOR:"darkkhaki",EXCLAMATION_BTN_COLOR:"darkkhaki",GAME_TEXT_FONT_FAMILY:'"Saira", serif',GAME_TEXT_FONT_SIZE:50},STATE:{LOCAL_STORAGE_KEY_HIGH_SCORE:"highScore",LOCAL_STORAGE_KEY_GAME_SPEED:"gameSpeed"},ERROR:{MESSAGE_FONT:"20px Arial",MESSAGE_COLOR:"red",MESSAGE_BACKGROUND:"rgba(0, 0, 0, 0.7)"}},{BOARD:t}=e,i="motionRequest";class n{constructor(e,i){if(this._canvas=e,this._ctrlPanel=i,!(this.ctx=this._canvas.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");this._boardSize=this._calculateBoardSize(),this._ratio=window.devicePixelRatio||1,this._sizeCanvas(),this._sizeControlPanel(),this._width=e.width,this._height=e.height,this._blockSize=e.width/t.NUM_STEPS_ACROSS_CANVAS,this._activeFilter=t.FILTERS.NONE,this._color=t.DEFAULT_BACKGROUND_COLOR,this._borderColor=t.DEFAULT_BORDER_COLOR,this._isGlowing=!1,this.resetFilter()}get canvas(){return this._canvas}get color(){return this._color}get borderColor(){return this._borderColor}get isGlowing(){return this._isGlowing}get activeFilter(){return this._activeFilter}get width(){return this._width}get height(){return this._height}get blockSize(){return this._blockSize}get ratio(){return this._ratio}resetFilter(){this._activeFilter=t.FILTERS.NONE}setEndGameFilter(){this._activeFilter=t.FILTERS.ENDGAME}setPauseGameFilter(){this._activeFilter=t.FILTERS.PAUSE}enterFullScreen(){this._canvas.requestFullscreen().then((function(){try{screen.lockOrientationUniversal=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation,screen.lockOrientationUniversal("portrait-primary")}catch(e){}}))}exitFullScreen(){document.exitFullscreen()}createMotionRequestBtn(){if(!this._ctrlPanel)return null;let e=document.createElement("button");return e.innerHTML="Allow Motion Control",e.setAttribute("id",i),e.type="button",this._ctrlPanel.appendChild(e),e}getMotionRequestBtn(){return document.getElementById(i)}removeMotionRequestBtn(){let e=this.getMotionRequestBtn();e?.parentNode?.removeChild(e)}setGlow(e){e!==this.isGlowing&&(this._isGlowing=e,e?(this._color=t.TELEPORT_BACKGROUND_COLOR,this._borderColor=t.TELEPORT_BORDER_COLOR):(this._color=t.DEFAULT_BACKGROUND_COLOR,this._borderColor=t.DEFAULT_BORDER_COLOR))}needsPermission(){return null!==document.getElementById(i)}_calculateBoardSize(){const e=(Math.min(window.innerWidth,window.innerHeight)-t.CTRL_PANEL_HEIGHT)/t.NUM_STEPS_ACROSS_CANVAS;return Math.floor(e)*t.NUM_STEPS_ACROSS_CANVAS-t.MARGIN_SIZE}_sizeCanvas(){this._canvas.style.width=this._boardSize+"px",this._canvas.style.height=this._boardSize+"px",this._canvas.width=this._boardSize*this._ratio,this._canvas.height=this._canvas.width}_sizeControlPanel(){this._ctrlPanel&&(this._ctrlPanel.style.width=this._boardSize+"px",this._ctrlPanel.style.height=t.CTRL_PANEL_HEIGHT+"px")}}const{ERROR:o}=e;function s(e,t=null){t&&t instanceof HTMLCanvasElement?function(e,t){const i=t.getContext("2d");if(!i)return console.error("unable to get 2D context from canvas"),void r(e);i.save(),i.font=o.MESSAGE_FONT,i.fillStyle=o.MESSAGE_BACKGROUND;const n=i.measureText(e).width+20,s=30,a=(t.width-n)/2,h=t.height/2-s/2;i.fillRect(a,h,n,s),i.fillStyle=o.MESSAGE_COLOR,i.textAlign="center",i.textBaseline="middle",i.fillText(e,t.width/2,t.height/2),i.restore()}(e,t):r(e)}function r(e){const t=document.createElement("div");t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.backgroundColor=o.MESSAGE_BACKGROUND,t.style.color=o.MESSAGE_COLOR,t.style.padding="15px",t.style.borderRadius="5px",t.style.zIndex="1000",t.style.whiteSpace="pre-wrap",t.style.maxWidth="80%",t.style.overflowWrap="break-word",t.textContent=e,document.body.appendChild(t)}const{ITEM:a}=e,h="Phase",l="Teleport";class _{constructor(e,t){this._x=Number.MIN_SAFE_INTEGER,this._y=Number.MIN_SAFE_INTEGER,this._generate(e,t)}get x(){return this._x}get y(){return this._y}get type(){return"UNKNOWN_ITEM"}get fillColor(){return""}get borderColor(){return""}_generate(e,t){this._x=this._randomBlock(0,e.width-e.blockSize,e.blockSize),this._y=this._randomBlock(0,e.height-e.blockSize,e.blockSize),t.forEachSegment((i=>{i.x==this.x&&i.y==this.y&&this._generate(e,t)}))}_randomBlock(e,t,i){return Math.round((Math.random()*(t-e)+e)/i)*i}}class d extends _{get type(){return"FOOD"}get fillColor(){return a.FOOD_COLOR}get borderColor(){return a.FOOD_BORDER_COLOR}}class c extends _{get type(){return"TELEPORT"}get fillColor(){return a.TELEPORT_COLOR}get borderColor(){return a.TELEPORT_BORDER_COLOR}}class u extends _{get type(){return"PHASE"}get fillColor(){return a.PHASE_COLOR}get borderColor(){return a.PHASE_BORDER_COLOR}}const E={none:null,food:d,teleport:c,phase:u};function O(e,t,i={}){const{alwaysReturnItem:n=!1,reducePowerUpProbability:o=!1}=i,s=function(e,t,i,n){const o=function(e,t,i,n){if(e===a.TELEPORT_SCORE_THRESHOLD&&i)return 1;if(e>a.TELEPORT_SCORE_THRESHOLD&&!t[l])return n?a.BASE_TELEPORT_PROBABILITY/10:a.BASE_TELEPORT_PROBABILITY;return 0}(e,t,i,n),s=function(e,t,i,n){if(e===a.PHASE_SCORE_THRESHOLD&&i)return 1;if(e>a.PHASE_SCORE_THRESHOLD&&!t[h])return n?a.BASE_PHASE_PROBABILITY/10:a.BASE_PHASE_PROBABILITY;return 0}(e,t,i,n);let r,_;i?(r=1-o-s,_=0):(r=a.BASE_VOLATILE_FOOD_PROBABILITY,_=1-o-s-r);const d={none:_,food:r,teleport:o,phase:s},c=Object.values(d).reduce(((e,t)=>e+t),0);if(Math.abs(c-1)>1e-10)throw new Error(`Item probabilities must sum to 1. Current sum: ${c}`);return d}(e,t,n,o),r=function(e){const t=Math.random();let i=0;for(const[n,o]of Object.entries(e))if(i+=o,t<=i)return n;throw new Error("item selection failed")}(s);return E[r]}const g="left",S="right",m="up",T="down",R={[g]:{dx:-1,dy:0},[S]:{dx:1,dy:0},[m]:{dx:0,dy:-1},[T]:{dx:0,dy:1}};const{SNAKE:b}=e;class C{constructor(e,t,i){this._blockSize=i;const n=Math.floor(e/(2*i))*i,o=Math.floor(t/(2*i))*i;this._body=this._createBody(n,o,b.INITIAL_LENGTH),this._dx=this._dxAtPause=i,this._dy=this._dyAtPause=0,this._isChangingDirection=!1,this._color=b.DEFAULT_COLOR,this._borderColor=b.DEFAULT_BORDER_COLOR,this._isGlowing=!1,this.powerUps={[l]:!1,[h]:!1},this._directionMap=new Map([[`${i},0`,S],[-i+",0",g],["0,"+-i,m],[`0,${i}`,T]])}_createBody(e,t,i){const n=[];for(let o=0;o<i;o++)n.push({x:e-o*this._blockSize,y:t});return n}get color(){return this._color}get borderColor(){return this._borderColor}get isGlowing(){return this._isGlowing}getHeadPosition(){return{...this._body[0]}}getCurrentDirection(){const e=`${this._dx},${this._dy}`;return this._directionMap.get(e)||"unknown"}move(e=!1){this._advanceHead(),e||this._advanceTail()}_advanceHead(){const e={x:Math.round((this.getHeadPosition().x+this._dx)/this._blockSize)*this._blockSize,y:Math.round((this.getHeadPosition().y+this._dy)/this._blockSize)*this._blockSize};this._body.unshift(e),this._isChangingDirection=!1}_advanceTail(){this._body.pop()}teleportHead(e){this._body[0]={...e}}forEachSegment(e){this._body.forEach(((t,i)=>e({...t},i)))}pause(){this._dxAtPause=this._dx,this._dyAtPause=this._dy,this._dx=this._dy=0}unpause(){this._dx=this._dxAtPause,this._dy=this._dyAtPause}didEat(e){let t=this.getHeadPosition();return t.x===e.x&&t.y===e.y}equip(e){e instanceof c&&(this.powerUps[l]=!0),e instanceof u&&(this.powerUps[h]=!0,this.setGlow(!0))}setGlow(e){e!==this.isGlowing&&(this._isGlowing=e,this._borderColor=e?b.PHASE_BORDER_COLOR:b.DEFAULT_BORDER_COLOR)}didCollide(e,t,i){let n=this.getHeadPosition();if(this._body.slice(4).some((e=>e.x===n.x&&e.y===n.y)))return!this.powerUps[h]||(this.powerUps[h]=!1,this.setGlow(!1),console.log("snek phased!"),!1);const o=n.x<0,s=n.x+i>e,r=n.y<0,a=n.y+i>t;return!!(o||s||r||a)&&(!this.powerUps[l]||(this.powerUps[l]=!1,o?this.teleportHead({x:e-i,y:n.y}):s?this.teleportHead({x:0,y:n.y}):r?this.teleportHead({x:n.x,y:t-i}):a&&this.teleportHead({x:n.x,y:0}),console.log("snek teleported!"),!1))}changeDirection(e){if(this._isChangingDirection)return!1;const t=function(e){return R[e.toLowerCase()]||null}(e);if(!t)return!1;const i=this._getCurrentDirection();return o=t,((n=i).dx!==-o.dx||n.dy!==-o.dy)&&(this._setNewDirection(t),!0);var n,o}_getCurrentDirection(){return function(e,t){const i=Math.max(Math.abs(e),Math.abs(t));return 0===i?{dx:0,dy:0}:{dx:e/i,dy:t/i}}(this._dx,this._dy)}_setNewDirection(e){this._isChangingDirection=!0,this._dx=e.dx*this._blockSize,this._dy=e.dy*this._blockSize}}const{INPUT:A}=e,p="Space",v="ArrowLeft",y="ArrowRight",L="ArrowUp",w="ArrowDown";class I{constructor(e){this._game=e,this._motionAvailable=null,this._deviceOrientation={beta:0,gamma:0},this._lastOrientationUpdate=0,this._touchStart={x:0,y:0},this._touchEnd={x:0,y:0},this._boundMethods=this._bindMethods()}manageGameControls(e){this._manageKeyboardControls(e),this._manageTouchControls(e),this._manageVisibilityControl(e),this._managePauseControl(e),this._manageFullscreenControl(e),this._manageDeviceOrientationControl(e)}manageRestartControls(e){const t=e?"addEventListener":"removeEventListener";e&&!this._motionAvailable&&document.removeEventListener("keydown",this._boundMethods.handleKeyInput),document[t]("keydown",this._boundMethods.handleRestart),document[t]("click",this._boundMethods.handleRestart)}_bindMethods(){return{handleKeyInput:this._handleKeyInput.bind(this),handleDeviceMovement:this._handleDeviceMovement.bind(this),handleVisibilityChange:this._handleVisibilityChange.bind(this),requestDeviceOrientation:this._requestDeviceOrientation.bind(this),togglePause:this._game.togglePause.bind(this._game),enterFullScreen:this._game.board.enterFullScreen.bind(this._game.board),handleTouchStart:this._handleTouchStart.bind(this),handleTouchEnd:this._handleTouchEnd.bind(this),handleRestart:this._handleRestart.bind(this)}}_manageKeyboardControls(e){document[e?"addEventListener":"removeEventListener"]("keydown",this._boundMethods.handleKeyInput)}_manageTouchControls(e){const t=e?"addEventListener":"removeEventListener";this._game.board.canvas[t]("touchstart",this._boundMethods.handleTouchStart),this._game.board.canvas[t]("touchend",this._boundMethods.handleTouchEnd)}_manageVisibilityControl(e){document[e?"addEventListener":"removeEventListener"]("visibilitychange",this._boundMethods.handleVisibilityChange,!1)}_managePauseControl(e){document[e?"addEventListener":"removeEventListener"]("click",this._boundMethods.togglePause)}_manageFullscreenControl(e){document[e?"addEventListener":"removeEventListener"]("dblclick",this._boundMethods.enterFullScreen)}_manageDeviceOrientationControl(e){const t=e?"addEventListener":"removeEventListener";if("undefined"!=typeof DeviceOrientationEvent)if("function"==typeof DeviceOrientationEvent.requestPermission)if(e){let e=this._game.board.createMotionRequestBtn();e&&(e.addEventListener("click",this._boundMethods.requestDeviceOrientation),this._game.togglePause())}else{let e=this._game.board.getMotionRequestBtn();e&&e.removeEventListener("click",this._boundMethods.requestDeviceOrientation)}else window[t]("deviceorientation",this._boundMethods.handleDeviceMovement)}_handleKeyInput(e){const t={[v]:new f(g),[y]:new f(S),[L]:new f(m),[w]:new f(T),[p]:new M}[e.code];t&&(null!==this._motionAvailable||this._game.state._ended||console.log("key controls activated"),this._disableMotionControl(),t.execute(this._game))}_handleRestart(e){(e instanceof KeyboardEvent&&e.code===p||"click"===e.type||"touchend"===e.type)&&this._game.restart()}_handleDeviceMovement(e){const t=Date.now(),i={beta:e.beta||0,gamma:e.gamma||0};if(t-this._lastOrientationUpdate<A.MOTION_THROTTLE_TIME_MS)return;const n={beta:this._deviceOrientation.beta-i.beta,gamma:this._deviceOrientation.gamma-i.gamma};null===this._motionAvailable&&this._isSignificantMotion(n)&&this._enableMotionControl();const o=this._getDirectionFromOrientation(n);if(o){new f(o).execute(this._game),this._lastOrientationUpdate=t,this._deviceOrientation=i}}_isSignificantMotion(e){return Math.abs(e.beta)>A.MOTION_SENSITIVITY||Math.abs(e.gamma)>A.MOTION_SENSITIVITY}_getDirectionFromOrientation(e){if(Math.abs(e.beta)>Math.abs(e.gamma)){if(e.beta<-A.MOTION_SENSITIVITY)return T;if(e.beta>A.MOTION_SENSITIVITY)return m}else{if(e.gamma<-A.MOTION_SENSITIVITY)return S;if(e.gamma>A.MOTION_SENSITIVITY)return g}return null}_handleVisibilityChange(){document.hidden&&!this._game.state.paused&&this._game.togglePause()}_requestDeviceOrientation(){DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&this._enableMotionControl()})).catch(console.error)}_enableMotionControl(){document.removeEventListener("keydown",this._boundMethods.handleKeyInput),window.addEventListener("deviceorientation",this._boundMethods.handleDeviceMovement),this._game.board.removeMotionRequestBtn(),this._game.state.setSpeed(A.GAME_SPEED_MS__MOTION),this._motionAvailable=!0,console.log("motion controls activated")}_disableMotionControl(){this._game.board.removeMotionRequestBtn(),window.removeEventListener("deviceorientation",this._handleDeviceMovement),this._game.state.setSpeed(A.GAME_SPEED_MS__ARROW),this._motionAvailable=!1}_debugMotionControl(){console.log("motion control debug info",{motionAvailable:this._motionAvailable,deviceOrientation:this._deviceOrientation,isChangingDirection:this._game.snake._isChangingDirection,snakeDirection:this._game.snake.getCurrentDirection()})}_handleTouchStart(e){e.preventDefault();const t=e.changedTouches[0];this._touchStart={x:t.screenX,y:t.screenY}}_handleTouchEnd(e){e.preventDefault();const t=e.changedTouches[0];this._touchEnd={x:t.screenX,y:t.screenY},this._handleSwipeGesture()}_handleSwipeGesture(){this._touchStart.y-this._touchEnd.y>A.SWIPE_SENSITIVITY?this._game.board.enterFullScreen():this._touchEnd.y-this._touchStart.y>A.SWIPE_SENSITIVITY?this._game.board.exitFullScreen():this._game.state.ended?this._game.restart():this._game.togglePause()}}class M{execute(e){e.togglePause()}}class f{constructor(e){this.direction=e}execute(e){e.snake.changeDirection(this.direction)}}const{CANVAS:P}=e;function x(e,t){const i=.5;try{e.translate(i,i),t()}finally{e.translate(-.5,-.5)}}var D=Object.freeze({__proto__:null,drawGame:function(e){let t=e.board,i=t.ctx;i.save(),x(i,(()=>{if(i.filter=t.activeFilter,i.fillStyle=t.color,t.isGlowing?(t.canvas.style.border="none",t.canvas.style.outline=`${t.borderColor} dashed thin`,t.canvas.style.boxShadow=`0 0 10px ${t.color}`,t.canvas.style.transition="box-shadow linear 1s"):(t.canvas.style.border=`2px solid ${t.borderColor}`,t.canvas.style.outline="none",t.canvas.style.boxShadow="none",t.canvas.style.transition="box-shadow linear 0.5s"),i.fillRect(0,0,t.canvas.width,t.canvas.height),e.state.paused){let e=t.needsPermission();const n=P.GAME_TEXT_FONT_SIZE*t.ratio,o=5*t.ratio;i.font=`${n}px "bootstrap-icons"`,i.fillStyle=e?P.EXCLAMATION_BTN_COLOR:P.PAUSE_BTN_COLOR,i.fillText(String.fromCharCode(e?62266:62655),o,n+o,t.canvas.width)}})),i.restore()},drawSnake:function(e,t){const i=t.ctx;i.save(),x(i,(()=>{e.isGlowing&&(i.lineCap="round",i.shadowBlur=18,i.shadowColor=e.color),i.fillStyle=e.color,i.strokeStyle=e.borderColor,e.forEachSegment((e=>{i.fillRect(e.x,e.y,t.blockSize,t.blockSize),i.strokeRect(e.x,e.y,t.blockSize,t.blockSize)}))})),i.restore()},drawItem:function(e,t){let i=t.ctx;i.save(),x(i,(()=>{i.fillStyle=e.fillColor,i.strokeStyle=e.borderColor,i.fillRect(e.x,e.y,t.blockSize,t.blockSize),i.strokeRect(e.x,e.y,t.blockSize,t.blockSize)})),i.restore()},drawScore:function(e,t){let i=t.ctx;i.save(),i.font=`${P.GAME_TEXT_FONT_SIZE*t.ratio}px ${P.GAME_TEXT_FONT_FAMILY}`,i.textAlign="center",i.fillStyle=P.GAME_TEXT_COLOR,i.fillText(e.toString(),t.canvas.width/2,t.canvas.height/2-P.GAME_TEXT_FONT_SIZE/2*t.ratio,t.canvas.width),i.restore()},drawHighScore:function(e,t){let i=t.ctx;i.save(),i.font=`${P.GAME_TEXT_FONT_SIZE*t.ratio}px ${P.GAME_TEXT_FONT_FAMILY}`,i.textAlign="center",i.strokeStyle=P.HIGH_SCORE_TEXT_COLOR,i.strokeText(e.toString(),t.canvas.width/2,t.canvas.height/2+P.GAME_TEXT_FONT_SIZE/2*t.ratio,t.canvas.width),i.restore()},drawGameOver:function(e){let t=e.ctx;t.save(),t.font=`${P.GAME_TEXT_FONT_SIZE*e.ratio}px ${P.GAME_TEXT_FONT_FAMILY}`,t.textAlign="center",t.fillStyle=P.GAME_TEXT_COLOR,t.fillText("DED",e.canvas.width/2,e.canvas.height/2,e.canvas.width),t.restore()}});const{renderGame:N,renderGameOver:G}=function(e=D){return{renderGame:function(t){e.drawGame(t),e.drawScore(t.state.score,t.board),e.drawHighScore(t.state.highScore,t.board),e.drawItem(t.item,t.board),e.drawSnake(t.snake,t.board)},renderGameOver:function(t){t.board.setEndGameFilter(),e.drawGame(t),e.drawItem(t.item,t.board),e.drawSnake(t.snake,t.board),e.drawGameOver(t.board)}}}(),{INPUT:k,STATE:F}=e;class B{constructor(){this._paused=!1,this._ended=!1,this._score=0,this._highScore=this._getItemSafely(F.LOCAL_STORAGE_KEY_HIGH_SCORE,0),this._speed=this._getItemSafely(F.LOCAL_STORAGE_KEY_GAME_SPEED,k.GAME_SPEED_MS__ARROW)}get speed(){return this._speed}get score(){return this._score}get highScore(){return this._highScore}get paused(){return this._paused}get ended(){return this._ended}updateScore(e){this._score+=e}updateHighScore(){this.score>this.highScore&&(this._highScore=this.score,this._setItemSafely(F.LOCAL_STORAGE_KEY_HIGH_SCORE,this.score))}setSpeed(e){"number"!=typeof e||isNaN(e)||(this._speed=Math.max(0,Math.round(e)))}togglePause(){this._paused=!this.paused}endGame(){this._ended=!0,this._setItemSafely(F.LOCAL_STORAGE_KEY_GAME_SPEED,this.speed)}_getItemSafely(e,t){try{const i=localStorage.getItem(e);return null!==i?JSON.parse(i):t}catch(e){return console.warn(`Error reading from localStorage: ${e.message}`),t}}_setItemSafely(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.warn(`Error writing to localStorage: ${e.message}`)}}}const{GAME:H}=e,U="gameCanvas",z="controlPanel";class Y{constructor(e,t,i){this.board=e,this.snake=t,this.item=i,this.state=new B,this.input=new I(this),this._lastUpdateTimestamp=0}run(e){if(this._shouldUpdateFrame(e)){if(this._updateFrame(),this.state._ended)return void G(this);N(this)}requestAnimationFrame((e=>this.run(e)))}togglePause(){this.state.togglePause(),this.state.paused?(this.snake.pause(),this.board.setPauseGameFilter()):(this.snake.unpause(),this.board.resetFilter()),console.log("game "+(this.state.paused?"paused":"resumed"))}restart(){this.input.manageRestartControls(!1),console.log("game restarted"),K()}_shouldUpdateFrame(e){return e-this._lastUpdateTimestamp>=this.state.speed&&(this._lastUpdateTimestamp=e,!0)}_updateFrame(){this.state.ended||this.state.paused||this._advanceSnake()}_advanceSnake(){let e=this.snake.didEat(this.item);this.snake.move(e),e?(console.log(`snek ate item: ${this.item.type.toUpperCase()}`),this.state.updateScore(H.SCORE_INCREMENT),this.snake.equip(this.item),this.board.setGlow(this.snake.powerUps[l]),this._generateNewItem()):this._maybeRegenerateItem(),this._checkCollision()&&this._end()}_generateNewItem(){let e=O(this.state.score,this.snake.powerUps,{alwaysReturnItem:!0,reducePowerUpProbability:!1});null!==e&&(this.item=new e(this.board,this.snake),console.log(`new item generated: ${this.item.type.toUpperCase()}`))}_maybeRegenerateItem(){if(this.state.score>=H.SCORE_THRESHOLD_FOR_VOLATILE_FOOD||this.item instanceof c||this.item instanceof u){let e=O(this.state.score,this.snake.powerUps,{alwaysReturnItem:!1,reducePowerUpProbability:!0});null!==e&&(this.item=new e(this.board,this.snake),console.log(`item regenerated: ${this.item.type.toUpperCase()}`))}}_checkCollision(){return this.board.setGlow(this.snake.powerUps[l]),this.snake.didCollide(this.board.width,this.board.height,this.board.blockSize)}_end(){this.state.endGame(),this.state.updateHighScore(),this.input.manageGameControls(!1),this.input.manageRestartControls(!0),console.log(`game over - final score: ${this.state.score}`)}}function K(){try{let e=function(){let e,t;if(!(e=document.getElementById(U)))throw new Error(`HTML canvas with id '${U}' not found`);if(!(e instanceof HTMLCanvasElement))throw new Error(`#${U} element is not an HTML canvas`);(t=document.getElementById(z))||console.warn(`control panel element with id '${z}' not found. proceeding without control panel.`);let i=new n(e,t);return i}(),t=new C(e.height,e.height,e.blockSize),i=new d(e,t),o=new Y(e,t,i);o.input.manageGameControls(!0),requestAnimationFrame((e=>o.run(e)))}catch(e){console.error("failed to initialize game:",e),s("Failed to start the game. Please refresh the page and try again.",document.getElementById(U))}}K();
//# sourceMappingURL=snek.min.js.map
